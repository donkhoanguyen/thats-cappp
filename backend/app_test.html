<!DOCTYPE html>
<html>
<head>
    <title>Audio Processing Client</title>
</head>
<body>
    <h2>Audio Processing Demo</h2>
    
    <!-- WebSocket Streaming -->
    <div>
        <h3>Real-time Streaming</h3>
        <button id="startStream">Start Streaming</button>
        <button id="stopStream">Stop Streaming</button>
        <div id="streamResults"></div>
    </div>

    <!-- File Upload -->
    <div>
        <h3>File Upload</h3>
        <input type="file" id="audioFile" accept="audio/*">
        <button id="uploadFile">Upload</button>
        <div id="uploadResults"></div>
    </div>

    <script>
        // WebSocket connection
        let ws = null;
        const streamResults = document.getElementById('streamResults');
        
        // Start streaming
        document.getElementById('startStream').onclick = async () => {
            ws = new WebSocket('ws://localhost:8000/ws/audio');
            
            ws.onopen = () => {
                console.log('Connected to WebSocket');
                // Start sending audio data
                // This is where you'd implement your audio capture logic
                const audioData = new Uint8Array(1024); // Example audio data
                ws.send(audioData);
            };
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                let result = '';
                
                switch(data.type) {
                    case 'transcription':
                        result = `Transcription: ${data.text}`;
                        break;
                    case 'claims':
                        result = `Claims: ${JSON.stringify(data.claims)}`;
                        break;
                    case 'fact_check':
                        result = `Fact Check Results: ${JSON.stringify(data.results)}`;
                        break;
                }
                
                streamResults.innerHTML += `<p>${result}</p>`;
            };
            
            ws.onerror = (error) => {
                console.error('WebSocket error:', error);
            };
            
            ws.onclose = () => {
                console.log('WebSocket connection closed');
            };
        };
        
        // Stop streaming
        document.getElementById('stopStream').onclick = () => {
            if (ws) {
                ws.close();
            }
        };
        
        // File upload
        document.getElementById('uploadFile').onclick = async () => {
            const fileInput = document.getElementById('audioFile');
            const file = fileInput.files[0];
            if (!file) {
                alert('Please select a file first');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', file);
            
            try {
                const response = await fetch('http://localhost:8000/upload/audio', {
                    method: 'POST',
                    body: formData
                });
                
                const results = await response.json();
                document.getElementById('uploadResults').innerHTML = 
                    `<pre>${JSON.stringify(results, null, 2)}</pre>`;
            } catch (error) {
                console.error('Upload error:', error);
                alert('Upload failed');
            }
        };
    </script>
</body>
</html>